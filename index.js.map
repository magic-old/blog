{"version":3,"sources":["src/index.js"],"names":[],"mappings":"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","file":"index.js","sourcesContent":["import { Router } from 'express';\nimport { join } from 'path';\nimport log from 'magic-server-log';\nimport { isNumber } from 'magic-types';\n\nconst router = Router();\n\nconst noop = () => {};\n\nrouter.get(\n  '/',\n  ({ app }, { render }, next = noop) => {\n    const dirs = app.get('dirs');\n    const blogRoot = join(dirs.views, app.get('blogRoot') || 'blog');\n    const template = join(blogRoot, 'list');\n\n    render(template);\n  });\n\nrouter.get(\n  '/tag/:tag',\n  ({ params }, { status }, next = noop) => {\n    status(200).send(`tag page ${params.tag}`);\n  });\n\nrouter.get(\n  '/category/:category',\n  ({ params }, { status }, next = noop) => {\n    status(200).send(`category page ${params.category}`);\n  });\n\nrouter.get(\n  '/:year/:month/:slug',\n  ({ app, params }, { render, status }, next = noop) => {\n    const viewDir = app.get('dirs').views;\n    const slug = params.slug;\n    const y = params.year;\n    const m = params.month;\n    const blogRoot = join(viewDir, app.get('blogRoot') || 'blog');\n    const postPath = join(blogRoot, y, m, slug);\n    const layoutPath = join(blogRoot, 'post');\n\n    if (!isNumber(y) || !isNumber(m)) {\n      return next();\n    }\n\n    render(\n      postPath,\n      (err, post) => {\n        if (err) {\n          log.error('error in magic-blog', err);\n          return next();\n        }\n\n        render(\n          layoutPath,\n          { post },\n          (err, content) => {\n            if (err) {\n              log.error('error in magic-blog', err);\n              return next();\n            }\n\n            status(200).send(content);\n          });\n      });\n  });\n\nrouter.get(\n  '/:year',\n  ({ params }, { status }, next = noop) => {\n    const { year } = params;\n\n    if (!isNumber(year)) {\n      return next();\n    }\n\n    log('yearly collection called', year);\n    status(200).send(`year of blog posts ${year}`);\n  });\n\nrouter.get(\n  '/:year/:month',\n  ({ params }, { status }, next = noop) => {\n    const { year, month } = params;\n\n    if (!isNumber(year) || !isNumber(month)) {\n      return next();\n    }\n\n    log('monthly collection called', month, year);\n    status(200).send(`month of blog posts ${month}/${year}`);\n  });\n\nexport default router;\n"]}